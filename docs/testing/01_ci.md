# Continuous Integration Pipeline

The GitHub Actions workflow (`.github/workflows/ci.yml`) enforces the quality bar for the
platform. Each job restores cached Poetry environments keyed off `pyproject.toml` and runs
with Python 3.11.

## Lint job

1. Configure Poetry to create an in-project virtual environment for reproducible caching.
2. Restore cached dependencies to avoid repeated downloads.
3. Install project and development requirements via `poetry install`.
4. Run `poetry run ruff check .` to lint all first-party Python packages and service
   entrypoints.
5. Run `poetry run black --check .` to verify formatting.
6. Run `poetry run mypy src` to catch type regressions before runtime.

## Test job

The test job depends on the lint job and reuses the cached Poetry environment. After
installing dependencies, it executes the full pytest suite:

```bash
poetry run pytest -v
```

Because `pytest.ini` now points to `tests/`, `src/agent/tests/`, and `src/stack/tests/`, CI
covers unit, service, and stack orchestration scenarios.

## Compose validation job

A lightweight job validates the docker-compose configuration that backs local orchestration:

```bash
docker compose -f docker-compose.yml config
```

The job pins to the base compose file so validation works in environments without GPU
support. Developers who need the Ollama GPU runtime can opt in locally with the
`docker-compose.gpu.yml` override.

Running this check in CI prevents syntax or merge errors in deployment descriptors from
reaching main.
