All checks passed!
All done! ‚ú® üç∞ ‚ú®
110 files left unchanged.
Success: no issues found in 63 source files
/usr/lib/python3.12/argparse.py:2479: UserWarning: Do not expect file_or_dir in Namespace(keyword='', markexpr='', maxfail=0, confcutdir=None, noconftest=False, keepduplicates=False, collect_in_virtualenv=False, continue_on_collection_errors=False, importmode='prepend', basetemp=None, durations=None, durations_min=None, showfixtures=False, show_fixtures_per_test=False, version=0, plugins=[], disable_plugin_autoload=False, traceconfig=False, verbose=0, no_header=False, no_summary=False, fold_skipped=True, force_short_summary=False, reportchars='a', disable_warnings=False, showlocals=False, tbstyle='auto', xfail_tb=False, showcapture='all', fulltrace=False, color='auto', code_highlight='yes', capture='fd', runxfail=False, pastebin=None, assertmode='rewrite', xmlpath=None, junitprefix=None, doctestmodules=False, doctestreport='udiff', doctestglob=[], doctest_ignore_import_errors=False, doctest_continue_on_failure=False, last_failed_no_failures='all', stepwise=False, stepwise_skip=False, stepwise_reset=False, logger_disable=[], markers=False, strict_config=None, strict_markers=None, strict=None, pythonwarnings=None, collectonly=False, pyargs=False, ignore=None, ignore_glob=None, deselect=None, inifilename=None, rootdir=None, help=False, debug=None, override_ini=None, usepdb=False, usepdb_cls=None, trace=False, lf=False, failedfirst=False, newfirst=False, cacheshow=None, cacheclear=False, setuponly=False, setupshow=False, setupplan=False, log_level=None, log_format=None, log_date_format=None, log_cli_level=None, log_cli_format=None, log_cli_date_format=None, log_file=None, log_file_mode=None, log_file_level=None, log_file_format=None, log_file_date_format=None, log_auto_indent=None, file_or_dir=[], asyncio_mode=None, asyncio_debug=None)
  warn('Do not expect %s in %s' % (action.dest, namespace))
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.0, pluggy-1.6.0
rootdir: /home/magnus/dev/ai-agent-platform/services/agent
configfile: pyproject.toml
testpaths: ../../tests, src/core/tests, src/stack/tests
plugins: respx-0.22.0, anyio-4.12.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 53 items

test_capabilities.py ..........                                          [ 18%]
test_compose_env.py FF                                                   [ 22%]
test_embedder_health.py .                                                [ 24%]
test_fetcher_fetch_endpoint.py .                                         [ 26%]
test_fetcher_mmr.py .                                                    [ 28%]
test_fetcher_toggle.py ..                                                [ 32%]
test_indexer_chunking.py .                                               [ 33%]
test_indexer_ingest_cli.py .                                             [ 35%]
test_ragproxy_embedder.py ..                                             [ 39%]
src/core/tests/test_app.py F                                             [ 41%]
src/core/tests/test_config.py .                                          [ 43%]
src/core/tests/test_filesystem.py .......                                [ 56%]
src/core/tests/test_memory.py ...                                        [ 62%]
src/core/tests/test_service.py ..                                        [ 66%]
src/core/tests/test_tools.py .....                                       [ 75%]
src/stack/tests/test_cli.py ..                                           [ 79%]
src/stack/tests/test_compose.py ..                                       [ 83%]
src/stack/tests/test_health.py ..                                        [ 86%]
src/stack/tests/test_utils.py .......                                    [100%]

=================================== FAILURES ===================================
_____________________ test_webfetch_receives_enable_qdrant _____________________

    def test_webfetch_receives_enable_qdrant():
        with COMPOSE_PATH.open("r", encoding="utf-8") as f:
            data = yaml.safe_load(f)
        wf = data.get("services", {}).get("webfetch", {})
        env = _env_list_to_dict(wf.get("environment", []))
>       assert "ENABLE_QDRANT" in env, "ENABLE_QDRANT must be passed to webfetch"
E       AssertionError: ENABLE_QDRANT must be passed to webfetch
E       assert 'ENABLE_QDRANT' in {}

../../tests/test_compose_env.py:25: AssertionError
_______________________ test_ragproxy_receives_rag_flags _______________________

    def test_ragproxy_receives_rag_flags():
        with COMPOSE_PATH.open("r", encoding="utf-8") as f:
            data = yaml.safe_load(f)
        rp = data.get("services", {}).get("ragproxy", {})
        env = _env_list_to_dict(rp.get("environment", []))
>       assert env.get("ENABLE_RAG") is not None
E       AssertionError: assert None is not None
E        +  where None = <built-in method get of dict object at 0x7f6f9e08de40>('ENABLE_RAG')
E        +    where <built-in method get of dict object at 0x7f6f9e08de40> = {}.get

../../tests/test_compose_env.py:33: AssertionError
_______________________ test_chat_completions_roundtrip ________________________

tmp_path = PosixPath('/tmp/pytest-of-magnus/pytest-10/test_chat_completions_roundtri0')

    @pytest.mark.asyncio
    async def test_chat_completions_roundtrip(tmp_path: Path) -> None:
        service = await build_service(tmp_path)
        app = create_app(service._settings, service=service)
        client = TestClient(app)
    
        payload = {
            "model": "agent-model",
            "messages": [
                {"role": "system", "content": "be helpful"},
                {"role": "user", "content": "Hello"},
            ],
            "metadata": {"tools": []},
        }
    
        response = client.post("/v1/chat/completions", json=payload)
>       assert response.status_code == 200
E       assert 500 == 200
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

src/core/tests/test_app.py:92: AssertionError
----------------------------- Captured stdout call -----------------------------
{
    "name": "POST /v1/chat/completions http receive",
    "context": {
        "trace_id": "0x8ed1c06a70b43e7e0962ff24beb35263",
        "span_id": "0xa3915ef5ef7d8953",
        "trace_state": "[]"
    },
    "kind": "SpanKind.INTERNAL",
    "parent_id": "0x9080c85e690009dd",
    "start_time": "2025-12-22T08:35:29.332677Z",
    "end_time": "2025-12-22T08:35:29.332690Z",
    "status": {
        "status_code": "UNSET"
    },
    "attributes": {
        "asgi.event.type": "http.request"
    },
    "events": [],
    "links": [],
    "resource": {
        "attributes": {
            "telemetry.sdk.language": "python",
            "telemetry.sdk.name": "opentelemetry",
            "telemetry.sdk.version": "1.39.1",
            "service.name": "AI Agent Server"
        },
        "schema_url": ""
    }
}
{
    "name": "POST /v1/chat/completions http send",
    "context": {
        "trace_id": "0x8ed1c06a70b43e7e0962ff24beb35263",
        "span_id": "0x94af3956ef709d21",
        "trace_state": "[]"
    },
    "kind": "SpanKind.INTERNAL",
    "parent_id": "0x9080c85e690009dd",
    "start_time": "2025-12-22T08:35:29.361276Z",
    "end_time": "2025-12-22T08:35:29.361320Z",
    "status": {
        "status_code": "ERROR"
    },
    "attributes": {
        "asgi.event.type": "http.response.start",
        "http.status_code": 500
    },
    "events": [],
    "links": [],
    "resource": {
        "attributes": {
            "telemetry.sdk.language": "python",
            "telemetry.sdk.name": "opentelemetry",
            "telemetry.sdk.version": "1.39.1",
            "service.name": "AI Agent Server"
        },
        "schema_url": ""
    }
}
{
    "name": "POST /v1/chat/completions http send",
    "context": {
        "trace_id": "0x8ed1c06a70b43e7e0962ff24beb35263",
        "span_id": "0x59fd91a1cbc1a86e",
        "trace_state": "[]"
    },
    "kind": "SpanKind.INTERNAL",
    "parent_id": "0x9080c85e690009dd",
    "start_time": "2025-12-22T08:35:29.361561Z",
    "end_time": "2025-12-22T08:35:29.361568Z",
    "status": {
        "status_code": "UNSET"
    },
    "attributes": {
        "asgi.event.type": "http.response.body"
    },
    "events": [],
    "links": [],
    "resource": {
        "attributes": {
            "telemetry.sdk.language": "python",
            "telemetry.sdk.name": "opentelemetry",
            "telemetry.sdk.version": "1.39.1",
            "service.name": "AI Agent Server"
        },
        "schema_url": ""
    }
}
{
    "name": "POST /v1/chat/completions http send",
    "context": {
        "trace_id": "0x8ed1c06a70b43e7e0962ff24beb35263",
        "span_id": "0x652bfc3b462b694a",
        "trace_state": "[]"
    },
    "kind": "SpanKind.INTERNAL",
    "parent_id": "0x9080c85e690009dd",
    "start_time": "2025-12-22T08:35:29.361655Z",
    "end_time": "2025-12-22T08:35:29.361662Z",
    "status": {
        "status_code": "UNSET"
    },
    "attributes": {
        "asgi.event.type": "http.response.body"
    },
    "events": [],
    "links": [],
    "resource": {
        "attributes": {
            "telemetry.sdk.language": "python",
            "telemetry.sdk.name": "opentelemetry",
            "telemetry.sdk.version": "1.39.1",
            "service.name": "AI Agent Server"
        },
        "schema_url": ""
    }
}
{
    "name": "POST /v1/chat/completions",
    "context": {
        "trace_id": "0x8ed1c06a70b43e7e0962ff24beb35263",
        "span_id": "0x9080c85e690009dd",
        "trace_state": "[]"
    },
    "kind": "SpanKind.SERVER",
    "parent_id": null,
    "start_time": "2025-12-22T08:35:29.332464Z",
    "end_time": "2025-12-22T08:35:29.361714Z",
    "status": {
        "status_code": "ERROR"
    },
    "attributes": {
        "http.scheme": "http",
        "http.host": "testserver",
        "net.host.port": 80,
        "http.flavor": "1.1",
        "http.target": "/v1/chat/completions",
        "http.url": "http://testserver/v1/chat/completions",
        "http.method": "POST",
        "http.server_name": "testserver",
        "http.user_agent": "testclient",
        "net.peer.ip": "testclient",
        "net.peer.port": 50000,
        "http.route": "/v1/chat/completions",
        "http.request.body": "{\"model\":\"agent-model\",\"messages\":[{\"role\":\"system\",\"content\":\"be helpful\"},{\"role\":\"user\",\"content\":\"Hello\"}],\"metadata\":{\"tools\":[]}}",
        "http.status_code": 500,
        "http.response.body": "{\"detail\":\"(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'conv-cd9e80947d9f46228920e2e0a8d6b981' (invalid UUID 'conv-cd9e80947d9f46228920e2e0a8d6b981': length must be between 32..36 characters, got 37)\\n[SQL: SELECT conversations.id AS conversations_id, conversations.platform AS conversations_platform, conversations.platform_id AS conversations_platform_id, conversations.context_id AS conversations_context_id, conversations.current_cwd AS conversations_current_cwd, conversations.created_at AS conversations_created_at, conversations.updated_at AS conversations_updated_at \\nFROM conversations \\nWHERE conversations.id = $1::UUID]\\n[parameters: ('conv-cd9e80947d9f46228920e2e0a8d6b981',)]\\n(Background on this error at: https://sqlalche.me/e/20/dbapi)\"}"
    },
    "events": [],
    "links": [],
    "resource": {
        "attributes": {
            "telemetry.sdk.language": "python",
            "telemetry.sdk.name": "opentelemetry",
            "telemetry.sdk.version": "1.39.1",
            "service.name": "AI Agent Server"
        },
        "schema_url": ""
    }
}
------------------------------ Captured log call -------------------------------
ERROR    core.core.app:app.py:188 Agent processing failed
Traceback (most recent call last):
  File "asyncpg/protocol/prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg/protocol/codecs/base.pyx", line 251, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg/protocol/codecs/base.pyx", line 153, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg/pgproto/codecs/uuid.pyx", line 16, in asyncpg.pgproto.pgproto.uuid_encode
  File "asyncpg/pgproto/uuid.pyx", line 88, in asyncpg.pgproto.pgproto.pg_uuid_bytes_from_str
ValueError: invalid UUID 'conv-cd9e80947d9f46228920e2e0a8d6b981': length must be between 32..36 characters, got 37

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 550, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 177, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 268, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 257, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 184, in bind_execute
  File "asyncpg/protocol/prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $1: 'conv-cd9e80947d9f46228920e2e0a8d6b981' (invalid UUID 'conv-cd9e80947d9f46228920e2e0a8d6b981': length must be between 32..36 characters, got 37)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'conv-cd9e80947d9f46228920e2e0a8d6b981' (invalid UUID 'conv-cd9e80947d9f46228920e2e0a8d6b981': length must be between 32..36 characters, got 37)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/magnus/dev/ai-agent-platform/services/agent/src/core/core/app.py", line 183, in _handle_chat_completions
    response = await svc.handle_request(agent_request, session=session)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/magnus/dev/ai-agent-platform/services/agent/src/core/core/service.py", line 68, in handle_request
    db_conversation = await session.get(Conversation, conversation_id)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 592, in get
    return await greenlet_spawn(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3680, in get
    return self._get_impl(
           ^^^^^^^^^^^^^^^
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3859, in _get_impl
    return db_load_fn(
           ^^^^^^^^^^^
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 695, in load_on_pk_identity
    session.execute(
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'conv-cd9e80947d9f46228920e2e0a8d6b981' (invalid UUID 'conv-cd9e80947d9f46228920e2e0a8d6b981': length must be between 32..36 characters, got 37)
[SQL: SELECT conversations.id AS conversations_id, conversations.platform AS conversations_platform, conversations.platform_id AS conversations_platform_id, conversations.context_id AS conversations_context_id, conversations.current_cwd AS conversations_current_cwd, conversations.created_at AS conversations_created_at, conversations.updated_at AS conversations_updated_at 
FROM conversations 
WHERE conversations.id = $1::UUID]
[parameters: ('conv-cd9e80947d9f46228920e2e0a8d6b981',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
=============================== warnings summary ===============================
../../../../.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/litellm/types/llms/anthropic.py:531
  /home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/litellm/types/llms/anthropic.py:531: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AnthropicResponseContentBlockToolUse(BaseModel):

../../../../.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/litellm/types/rag.py:181
  /home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/litellm/types/rag.py:181: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class RAGIngestRequest(BaseModel):

src/core/tests/test_app.py::test_chat_completions_roundtrip
  /home/magnus/dev/ai-agent-platform/services/agent/src/core/core/app.py:124: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

src/core/tests/test_app.py::test_chat_completions_roundtrip
src/core/tests/test_app.py::test_chat_completions_roundtrip
  /home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/fastapi/applications.py:4575: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

src/core/tests/test_app.py::test_chat_completions_roundtrip
  /home/magnus/dev/ai-agent-platform/services/agent/src/core/core/app.py:144: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("shutdown")

src/core/tests/test_service.py::test_agent_service_roundtrip
src/core/tests/test_service.py::test_agent_service_roundtrip
src/core/tests/test_service.py::test_plan_driven_flow
src/core/tests/test_tools.py::test_agent_service_executes_tool
  /home/magnus/dev/ai-agent-platform/services/agent/src/core/core/service.py:90: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    session.add(db_conversation)
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

src/core/tests/test_service.py::test_agent_service_roundtrip
src/core/tests/test_service.py::test_agent_service_roundtrip
src/core/tests/test_service.py::test_plan_driven_flow
src/core/tests/test_tools.py::test_agent_service_executes_tool
  /home/magnus/dev/ai-agent-platform/services/agent/src/core/core/service.py:139: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    session.add(
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

src/core/tests/test_service.py: 30 warnings
src/core/tests/test_tools.py: 10 warnings
  /home/magnus/dev/ai-agent-platform/services/agent/src/core/observability/tracing.py:214: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    span.set_attribute("span.end_time", datetime.utcnow().isoformat())

src/core/tests/test_service.py::test_agent_service_roundtrip
src/core/tests/test_service.py::test_agent_service_roundtrip
src/core/tests/test_service.py::test_plan_driven_flow
src/core/tests/test_tools.py::test_agent_service_executes_tool
  /home/magnus/dev/ai-agent-platform/services/agent/src/core/core/service.py:361: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    session.add(
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

src/core/tests/test_service.py::test_agent_service_roundtrip
src/core/tests/test_service.py::test_agent_service_roundtrip
src/core/tests/test_service.py::test_plan_driven_flow
src/core/tests/test_tools.py::test_agent_service_executes_tool
  /home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/lib/python3.12/site-packages/pydantic/main.py:250: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)

src/core/tests/test_service.py::test_plan_driven_flow
  /home/magnus/dev/ai-agent-platform/services/agent/src/core/core/service.py:323: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    session.add(
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED test_compose_env.py::test_webfetch_receives_enable_qdrant - AssertionE...
FAILED test_compose_env.py::test_ragproxy_receives_rag_flags - AssertionError...
FAILED src/core/tests/test_app.py::test_chat_completions_roundtrip - assert 5...
================== 3 failed, 50 passed, 63 warnings in 7.79s ===================

[1müöÄ Starting Quality Assurance Checks...[0m
   Root: /home/magnus/dev/ai-agent-platform
   Mode: Local

[94m[1m==> Running Global Linters[0m
[93m‚ÑπÔ∏è  Ruff: Auto-fix enabled[0m
[94m$ /home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/bin/python -m ruff check --fix . --config /home/magnus/dev/ai-agent-platform/services/agent/pyproject.toml[0m
  (cwd: /home/magnus/dev/ai-agent-platform)
[93m‚ÑπÔ∏è  Black: Auto-formatting enabled[0m
[94m$ /home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/bin/python -m black . --config /home/magnus/dev/ai-agent-platform/services/agent/pyproject.toml --extend-exclude /(data|services/openwebui/data)|.*\.venv[0m
  (cwd: /home/magnus/dev/ai-agent-platform)

[94m[1m==> Running Service-Level Checks[0m

[1müëâ Service: services/agent[0m
[94m$ /home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/bin/python -m mypy[0m
  (cwd: /home/magnus/dev/ai-agent-platform/services/agent)
[94m$ /home/magnus/.cache/pypoetry/virtualenvs/ai-agent-platform-hIn861qG-py3.12/bin/python -m pytest[0m
  (cwd: /home/magnus/dev/ai-agent-platform/services/agent)
[91m‚ùå Command failed with exit code 1[0m
